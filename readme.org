* Introduction
Welcome to my Emacs configuration, at a first glance Emacs seems like a text editor, but when you take time to play around, you will see it's more than that. Took me a while to understand, and time to time I get surprise with their capabilities.

I use Emacs in my daily basis to work, organize my Life, programming in [[Javascript]]/[[Typescript]], [[Elisp]], [[Lua]] and [[Flutter]].

As many Emacs users I update my configuration frequently with a new tool, new language or anything new I want to try.

I like to work with beautiful and [[*Nyan cat][fun]] environments, so I'm always trying to make Emacs prettier

Some screenshots

My Startup Screen
[[./screenshots/dashboard.png]]

Org Mode
[[./screenshots/org-mode.png]]

Typescript with autocomplete
[[./screenshots/typescript-autocomplete.png]]

Typescript erros
[[./screenshots/typescript-errors.png]]

** References
The following list is from people I have been learning and stealing Emacs configuration ideas and chunks
- [[https://github.com/clarete/emacs.d][Lincoln Clarete]]
- [[https://github.com/daviwil/dotfiles][David Wilson]]
* Package manager
Straight.el
#+begin_src elisp
  (setq package-enable-at-startup nil)
  (defvar bootstrap-version)
  (let ((bootstrap-file
         (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
        (bootstrap-version 5))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer
          (url-retrieve-synchronously
           "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
           'silent 'inhibit-cookies)
        (goto-char (point-max))
        (eval-print-last-sexp)))
    (load bootstrap-file nil 'nomessage))

  (straight-use-package 'use-package)
  (setq straight-use-package-by-default t)

  (use-package use-package-ensure-system-package)
#+end_src
* General
#+begin_src elisp
  ;; Close all dired buffers after opening
  (setq dired-kill-when-opening-new-dired-buffer t)

  (defun dont-kill-scratch ()
    "This function doesn't let you kill scratch by mistake."
    (if (not (equal (buffer-name) "*scratch*"))
        t
      (bury-buffer)
      nil))
  (add-hook 'kill-buffer-query-functions #'dont-kill-scratch)
  ;; Don't ask about variables and functions from .dir-locals
  (advice-add 'risky-local-variable-p :override #'ignore)
#+end_src
** Startup Performance
Make startup faster by reducing the frequency of garbage collection and then use a hook to measure Emacs startup time.
#+begin_src emacs-lisp
  ;; The default is 800 kilobytes.  Measured in bytes.
  (setq gc-cons-threshold (* 50 1000 1000))
#+end_src

** Native Compilation
Silence compiler warnings as they can be pretty disruptive
#+begin_src elisp
  (setq native-comp-async-report-warnings-errors nil)
#+end_src
** Encoding
From [[https://github.com/doomemacs/doomemacs/blob/594d70292dc134d483fbf7a427001250de07b4d2/lisp/doom-start.el#L132-L134][Doom emacs]]
Contrary to what many Emacs users have in their configs, you don't need more than this to make UTF-8 the default coding system:
#+begin_src elisp
(set-language-environment "UTF-8")
#+end_src
** Path
Load environment variables from the shell
#+begin_src elisp
  (use-package add-node-modules-path)
  (use-package exec-path-from-shell)
  (setq exec-path-from-shell-variables '("GOPATH" "PATH" "MANPATH"))
  (exec-path-from-shell-initialize)
#+end_src

Set the start point for the current buffer, this means if you will search for a file, the start point will be the default-directory value.
#+begin_src elisp
(setq default-directory "~/")
#+end_src

* Startup Screen
#+begin_src elisp
  (use-package dashboard
    :config
    (setq dashboard-banner-logo-title "OlÃ¡, bem vindo ao Emacs"
          dashboard-startup-banner "~/.emacs.d/nyan-cat.png"
          dashboard-center-content t
          dashboard-agenda-release-buffers t
          dashboard-items '((projects . 5) (agenda . 5)))
    (dashboard-setup-startup-hook))
#+end_src

* Keep .emacs.d clean
I don't want a bunch of transient files showing up as untracked in the Git repo so I move them all to another location.
#+begin_src elisp
  (setq custom-file
          (if (boundp 'server-socket-dir)
              (expand-file-name "custom.el" server-socket-dir)
            (expand-file-name (format "emacs-custom-%s.el" (user-uid)) temporary-file-directory)))
    (load custom-file t)

  (setq backup-directory-alist
        `((".*" . ,temporary-file-directory))
        auto-save-file-name-transforms
        `((".*" ,temporary-file-directory t))
        create-lockfiles nil)

  (setq tramp-auto-save-directory temporary-file-directory)
#+end_src

* Mac OS
#+begin_src elisp
  (when (eq system-type 'darwin)
    (add-to-list 'default-frame-alist '(undecorated . t))
    (setq mac-option-modifier 'alt)
    (setq mac-command-modifier 'meta)

    ;; Keys for visiting next & previous windows
    (global-set-key (kbd "<A-tab>") #'other-window)
    (global-set-key (kbd "<A-S-tab>")
                    #'(lambda () (interactive) (other-window -1)))

    ;; Keys for visiting next & previous frame
    (global-set-key (kbd "M-`") #'other-frame)
    (global-set-key (kbd "M-~") #'(lambda () (interactive) (other-frame -1)))

    ;; sets fn-delete to be right-delete
    (global-set-key [kp-delete] 'delete-char)
    (menu-bar-mode 1)

    ;; Enable mac option to create accented characters
    (setq ns-alternate-modifier 'none)
    (setq frame-resize-pixelwise t)
    (setq ns-left-alternate-modifier 'none))

#+end_src

* Emacs Server
Start the Emacs server from this instance so that all =emacsclient= calls are routed here.
It's required to be able to use Emacs as my [[*Yequake][dropdown terminal]].
#+begin_src elisp
(server-start)
#+end_src
* Look & Feel
** Improve theme loading
Source: [[https://www.reddit.com/r/emacs/comments/4mzynd/what_emacs_theme_are_you_currently_using/d43c5cw][Reddit]]
#+begin_src elisp
  (defadvice load-theme (before clear-previous-themes activate)
    "Clear existing theme settings instead of layering them"
    (mapc #'disable-theme custom-enabled-themes))
#+end_src

** Theme
*** Doom Themes
#+begin_src elisp
  (use-package doom-themes
    :config
    (doom-themes-neotree-config)
    (setq
     doom-themes-treemacs-theme "doom-colors"
     light-theme "doom-solarized-light"
     dark-theme "doom-tomorrow-night")
    (with-eval-after-load 'doom-themes
      (doom-themes-treemacs-config))
    (set-face-attribute 'default nil :font "Menlo 13")
    (set-face-attribute 'region nil :background "#000" :foreground "#ffffff")

    (load-theme (intern light-theme) t)

    :init
    (setq selected-theme light-theme)
    (load-theme (intern selected-theme) t)

    (defun gg-switch-theme()
      (interactive)
      (let* ((theme selected-theme)
             (change (if (string= theme light-theme) dark-theme light-theme)))
        (load-theme (intern change) t)
        (setq selected-theme change)
        (message "Theme switched from %s to %s" theme change)))
    (global-set-key (kbd "<f8>") 'gg-switch-theme))
#+end_src

** Neotree
#+begin_src elisp
  (defun text-scale-twice ()
    (interactive)
    (progn(text-scale-adjust 0)(text-scale-decrease 2)))

  (use-package neotree
    :bind([f9] . neotree-toggle)
    :hook (neo-after-create . (lambda (_)(call-interactively 'text-scale-twice)))
    :config
    (setq neo-autorefresh nil)
    (setq neo-smart-open t)
    (with-eval-after-load 'neotree
      (define-key neotree-mode-map (kbd "h") 'neotree-hidden-file-toggle)))

#+end_src
** Icons
#+begin_src elisp
  (use-package all-the-icons)
  (use-package all-the-icons-dired
    :hook (dired-mode . all-the-icons-dired-mode))
#+end_src

** Nyan cat
#+begin_src elisp
  (use-package nyan-mode
    :init
    (nyan-mode t))
#+end_src
** Emoji
#+begin_src elisp
  (use-package emojify
      :hook (after-init . global-emojify-mode))
#+end_src

** Dimmer
#+begin_src elisp :tangle no
  (use-package dimmer
      :init
      (dimmer-mode t)
      :config
      (setq dimmer-fraction 0.3))
#+end_src

** Emacs interface
#+begin_src elisp
  (scroll-bar-mode 0)
  (menu-bar-mode 0)
  (tool-bar-mode 0)
  (column-number-mode)
  (setq ring-bell-function 'ignore)
#+end_src

Writing yes or no is length, type y / n instead
#+begin_src elisp
(defalias 'yes-or-no-p 'y-or-n-p)
#+end_src

** Doom modeline
#+begin_src elisp
  (use-package doom-modeline
    :config
    (setq doom-modeline-height 25)
    (set-face-background 'doom-modeline-bar (face-background 'mode-line))
    (setq doom-modeline-bar-width 1)
    (doom-modeline-mode 1))
#+end_src
** Dialog
Don't pop up UI dialogs when prompting
#+begin_src elisp
  (setq use-dialog-box nil)
#+end_src
** Company
#+begin_src elisp
  (use-package company
    :hook (prog-mode . company-mode)
    :config
    (setq company-minimum-prefix-length 2))

    (global-company-mode)
    (global-set-key (kbd "TAB") #'company-indent-or-complete-common)

  (setq company-tooltip-align-annotations t)

  (use-package company-box
    :hook (company-mode . company-box-mode))
#+end_src
** Buffers
Before kill a modified buffer, give option to see the diff
Original code from [[https://emacs.stackexchange.com/questions/3245/kill-buffer-prompt-with-option-to-diff-the-changes/3363#3363][here]]
#+begin_src elisp
  (defun my/kill-this-buffer ()
    (interactive)
    (catch 'quit
      (save-window-excursion
        (let (done)
          (when (and buffer-file-name (buffer-modified-p))
            (while (not done)
              (let ((response (read-char-choice
                               (format "Save file %s? (y, n, d, q) " (buffer-file-name))
                               '(?y ?n ?d ?q))))
                (setq done (cond
                            ((eq response ?q) (throw 'quit nil))
                            ((eq response ?y) (save-buffer) t)
                            ((eq response ?n) (set-buffer-modified-p nil) t)
                            ((eq response ?d) (diff-buffer-with-file) nil))))))
          (kill-buffer (current-buffer))))))
#+end_src
* Key mapping
** Buffer/Window
#+begin_src elisp
  (global-set-key [s-tab] 'next-buffer)
  (global-set-key [S-s-iso-lefttab] 'previous-buffer)
  (global-set-key ["M-{"] 'next-buffer)
  (global-set-key ["M-}"] 'previous-buffer)

  ;; change window
  (global-set-key [(C-tab)] 'other-window)
  (global-set-key [(C-M-tab)] 'other-window)

  ;; Remap kill buffer to my/kill-this-buffer
  (global-set-key (kbd "C-x k") 'my/kill-this-buffer)

  ;; Revert buffer
  (global-set-key (kbd "C-<f5>") 'revert-buffer)

  ;; Go to scratch buffer
  (global-set-key (kbd "<f2>") (lambda() (interactive)(switch-to-buffer "*scratch*")))
#+end_src
** Code navigation
#+begin_src elisp
  (global-set-key (kbd "M-g") 'goto-line)
  (global-set-key (kbd "C-c s") 'sort-lines)
#+end_src
** Editing
#+begin_src elisp
  (global-set-key (kbd "C-c c") 'comment-region)
  (global-set-key (kbd "C-c d") 'uncomment-region)
#+end_src
** Conf
#+begin_src elisp
  (global-set-key (kbd "<f6>") (lambda() (interactive)(find-file "~/.emacs.d/readme.org")))
#+end_src

* Editing
#+begin_src elisp
  ;; Remembering the last place you visited in a file
  (save-place-mode 1)

  (setq-default truncate-lines t ;; Do not wrap lines
                indent-tabs-mode nil) ;; spaces instead of tabs

  (setq show-trailing-whitespace t ;; Complain about trailing white spaces
        whitespace-style '(face trailing lines tabs big-indent)) ;; Cleanup white spaces before save

  ;; Cleanup whitespace before save
  (add-hook 'before-save-hook 'whitespace-cleanup)
#+end_src
** Parenthesis
#+begin_src elisp
  (use-package smartparens)
  (smartparens-global-mode t)

  (use-package rainbow-delimiters
    :hook (prog-mode . rainbow-delimiters-mode))

  (use-package rainbow-mode)

  (use-package string-inflection)

  (global-hl-line-mode t)
#+end_src
** Display line numbers
#+begin_src elisp
  (add-hook 'prog-mode-hook #'display-line-numbers-mode)
  (add-hook 'conf-mode-hook #'display-line-numbers-mode)
#+end_src
** Indent Guides
#+begin_src elisp :tangle no
  (use-package highlight-indent-guides
    :config
    (setq highlight-indent-guides-method 'character)
    :hook (prog-mode . highlight-indent-guides-mode))
#+end_src

** Multiple cursor
#+begin_src elisp
      (use-package multiple-cursors
        :bind (("A-S-c A-S-c" . mc/edit-lines)
               ("C-." . mc/mark-next-like-this)
               ("C-," . mc/mark-previous-like-this)
               ("A->" . mc/mark-all-like-this)
               ("C-A-<mouse-1>" . mc/add-cursor-on-click)))
#+end_src
** Unfill paragraph
#+begin_src elisp
  (defun unfill-paragraph (&optional region)
    "Takes a multi-line paragraph or (REGION) and make it into a single line of text."
    (interactive (progn (barf-if-buffer-read-only) '(t)))
    (let ((fill-column (point-max))
          ;; This would override `fill-column' if it's an integer.
          (emacs-lisp-docstring-fill-column t))
      (fill-paragraph nil region)))
#+end_src
** Treesiter
#+begin_src elisp
  (require 'treesit)
  ;; modules build from https://github.com/casouri/tree-sitter-module
  (setq treesit-extra-load-path '("~/Projects/tree-sitter-module/dist"))
  (push '(css-mode . css-ts-mode) major-mode-remap-alist)
  (push '(javascript-mode . js-ts-mode) major-mode-remap-alist)
  (push '(js-json-mode . json-ts-mode) major-mode-remap-alist)
  (push '(typescript-mode . typescript-ts-mode) major-mode-remap-alist)
  (push '(typescript-mode . tsx-ts-mode) major-mode-remap-alist)
  (add-to-list 'auto-mode-alist '("\\.tsx?\\'" . tsx-ts-mode))
#+end_src

* Flymake
#+begin_src elisp
  (use-package sideline-flymake
    :hook (flymake-mode . sideline-mode)
    :custom
    (flymake-error-bitmap '(my-rounded-fringe-indicator compilation-error))
    (flymake-note-bitmap '(my-rounded-fringe-indicator compilation-info))
    (flymake-warning-bitmap '(my-rounded-fringe-indicator compilation-warning))
    :init
    (setq sideline-flymake-display-errors-whole-line 'point ; 'point to show errors only on point
          sideline-backends-right '(sideline-flymake))) ; 'line to show errors on the current line
#+end_src
*** Custom Fringe
#+begin_src elisp
  (when (fboundp 'define-fringe-bitmap)
    (define-fringe-bitmap 'my-rounded-fringe-indicator
      (vector #b00000000
              #b00000000
              #b00000000
              #b00000000
              #b00000000
              #b00000000
              #b00000000
              #b00011100
              #b00111110
              #b00111110
              #b00111110
              #b00011100
              #b00000000
              #b00000000
              #b00000000
              #b00000000
              #b00000000)))
#+end_src

*** Eslint
#+begin_src elisp
  ;; source: https://github.com/angrybacon/dotemacs/blob/master/lisp/use-lint.el
  (use-package flymake-eslint
    :functions flymake-eslint-enable
    :preface
    (defun flymake-eslint-enable-maybe ()
      "Enable `flymake-eslint' based on the project configuration.
  Search for the project ESLint configuration to determine whether the buffer
  should be checked."
      (when-let* ((root (locate-dominating-file (buffer-file-name) "package.json"))
                  (rc (locate-file ".eslintrc" (list root) '(".js" ".json"))))
        (make-local-variable 'exec-path)
        (push (file-name-concat root "node_modules" ".bin") exec-path)
        (setq-local flymake-eslint-project-root root)
        (flymake-eslint-enable))))
#+end_src
* Flyspell
#+begin_src elisp
  (use-package flyspell)
  (use-package flyspell-correct-popup)
  (setq ispell-program-name "aspell")
  (ispell-change-dictionary "pt_BR")

  (defun fd-switch-dictionary()
    (interactive)
    (let* ((dic ispell-current-dictionary)
           (change (if (string= dic "pt_BR") "english" "pt_BR")))
      (ispell-change-dictionary change)
      (message "Dictionary switched from %s to %s" dic change)))

  (global-set-key (kbd "<f7>") 'fd-switch-dictionary)
  (define-key flyspell-mode-map (kbd "C-;") 'flyspell-correct-wrapper)
#+end_src
* Yasnippet
#+begin_src elisp
  (use-package yasnippet
    :init
    :config
    (yas-load-directory "~/.emacs.d/snippets")
    (yas-global-mode 1))
#+end_src
* Code Folding
#+begin_src elisp
  (use-package yafolding
    :bind ("<C-return>" . yafolding-toggle-element))
#+end_src
* Restclient
#+begin_src elisp
  (use-package restclient)
#+end_src

* Projectile
#+begin_src elisp
  (use-package projectile
    :init
    (projectile-mode +1)
    :bind (
           ("C-c p" . projectile-command-map)
           ("M-[" . projectile-previous-project-buffer)
           ("M-]" . projectile-next-project-buffer))
    :config
    (setq projectile-indexing-method 'hybrid
          projectile-sort-order 'recently-active
          compilation-read-command nil
          projectile-comint-mode t)

    (add-to-list 'projectile-globally-ignored-directories "node_modules")
    (add-to-list 'projectile-globally-ignored-files "yarn.lock")
    :custom
    (projectile-globally-ignored-buffers '("*scratch*" "*lsp-log*" "*xref*" "*EGLOT" "*Messages*" "*compilation" "*vterm*" "*Flymake")))

#+end_src

* Magit
#+begin_src elisp
  (use-package magit)
  (use-package magit-todos)
#+end_src
* Git Timemachine
#+begin_src elisp
  (use-package git-timemachine)
#+end_src
* Blamer
#+begin_src elisp :tangle no
  (use-package blamer
  :bind (("s-i" . blamer-show-commit-info)
         ("s-n" . blamer-mode))
  :defer 20
  :custom
  (blamer-idle-time 0.3)
  (blamer-min-offset 10)
  :custom-face
  (blamer-face ((t :foreground "#9099AB"
                    :background nil
                    :height .9
                    :italic t))))
#+end_src
* Org
#+begin_src elisp
  (use-package org :straight (:type built-in)
    :custom
    (org-agenda-files
     '("/Users/guerra/Projects/org-files/roam/" "/Users/guerra/Projects/org-files/roam/daily"))
    (org-agenda-span 15)
    (org-deadline-warning-days 0)
    (org-icalendar-deadline-summary-prefix "")
    (org-icalendar-timezone "")
    (org-icalendar-use-deadline '(event-if-todo todo-due))
    (org-icalendar-with-timestamps nil)
    :bind (("C-c a" . (lambda () (interactive) (org-agenda nil "z")) )
           ("C-c /" . 'org-capture)
           ("s-c" . 'ox-clip-formatted-copy))
    :hook (org-mode . turn-on-flyspell))

  (use-package org-contrib)
  (use-package org-web-tools
    :custom
    (org-web-tools-pandoc-sleep-time 0.6))

  (use-package org-ql
    :after '(org)
    :straight (org-ql :host github :repo "alphapapa/org-ql"))
  (use-package git-auto-commit-mode)
  (use-package ox-clip)
  (require 'org-inlinetask)
  (require 'org-tempo)
  (require 'org-collector)
  (setq org-export-coding-system 'utf-8
        org-directory "~/Projects/org-files"
        org-tag-alist '(("work" . ?w) ("personal" . ?p) ("meta" . ?m) ("emacsLove" . ?l) ("quotes" . ?q) ("finances" . ?f) ("howto" . ?h))
        org-log-done nil
        org-log-repeat nil
        org-startup-indented t
        org-export-with-toc nil
        org-export-with-section-numbers nil
        gac-automatically-push-p t)
#+end_src
** Ox
*** Slack
#+begin_src elisp
  (use-package ox-slack
    :bind ("C-c e s" . org-slack-export-to-clipboard-as-slack))

#+end_src

** Reveal
#+begin_src elisp
  (use-package ox-reveal)
  (setq org-reveal-root "https://cdn.jsdelivr.net/npm/reveal.js"
        org-reveal-title-slide nil
        org-reveal-mathjax t)
  (use-package htmlize)
#+end_src
** Look & Feel
*** Olivetti
#+begin_src elisp
  (use-package olivetti
    :custom
    (olivetti-body-width 120)
    :config
    :hook ((markdown-mode . olivetti-mode)
           (org-mode . olivetti-mode)))
#+end_src
*** Org modern
#+begin_src elisp :tangle no
  (use-package org-modern
    :config
    (setq ;; Edit settings
     org-auto-align-tags nil
     org-tags-column 0
     org-fold-catch-invisible-edits 'show-and-error
     org-special-ctrl-a/e t
     org-insert-heading-respect-content t

     ;; Org styling, hide markup etc.
     org-hide-emphasis-markers t
     org-pretty-entities nil
     org-ellipsis "â€¦")
    (global-org-modern-mode))

#+end_src

*** SVG
#+begin_src elisp :tangle no
  (use-package svg-tag-mode
    :commands svg-tag-mode
    :config
    (defconst date-re "[0-9]\\{4\\}-[0-9]\\{2\\}-[0-9]\\{2\\}")
    (defconst time-re "[0-9]\\{2\\}:[0-9]\\{2\\}")
    (defconst day-re "[A-Za-z]\\{3\\}")
    (defconst day-time-re (format "\\(%s\\)? ?\\(%s\\)?" day-re time-re))
    (defun svg-progress-percent (value)
      (svg-image (svg-lib-concat
                  (svg-lib-progress-bar (/ (string-to-number value) 100.0)
                                        nil :margin 0 :stroke 2 :radius 3 :padding 2 :width 11)
                  (svg-lib-tag (concat value "%")
                               nil :stroke 0 :margin 0)) :ascent 'center))

    (defun svg-progress-count (value)
      (let* ((seq (mapcar #'string-to-number (split-string value "/")))
             (count (float (car seq)))
             (total (float (cadr seq))))
        (svg-image (svg-lib-concat
                    (svg-lib-progress-bar (/ count total) nil
                                          :margin 0 :stroke 2 :radius 3 :padding 2 :width 11)
                    (svg-lib-tag value nil
                                 :stroke 0 :margin 0)) :ascent 'center)))

    (setq svg-tag-tags
          `(
            ;; Org tags
            (":\\([A-Za-z0-9]+\\)" . ((lambda (tag) (svg-tag-make tag))))
            (":\\([A-Za-z0-9]+[ \-]\\)" . ((lambda (tag) tag)))
            ;; Task priority
            ("\\[#[A-Z]\\]" . ( (lambda (tag)
                                  (svg-tag-make tag :face 'org-priority
                                                :beg 2 :end -1 :margin 0))))

            ;; Progress
            ("\\(\\[[0-9]\\{1,3\\}%\\]\\)" . ((lambda (tag)
                                                (svg-progress-percent (substring tag 1 -2)))))
            ("\\(\\[[0-9]+/[0-9]+\\]\\)" . ((lambda (tag)
                                              (svg-progress-count (substring tag 1 -1)))))

            ;; TODO / DONE
            ("TODO" . ((lambda (tag) (svg-tag-make "TODO" :face 'org-todo :inverse t :margin 0))))
            ("DONE" . ((lambda (tag) (svg-tag-make "DONE" :face 'org-done :margin 0))))


            ;; Citation of the form [cite:@Knuth:1984]
            ("\\(\\[cite:@[A-Za-z]+:\\)" . ((lambda (tag)
                                              (svg-tag-make tag
                                                            :inverse t
                                                            :beg 7 :end -1
                                                            :crop-right t))))
            ("\\[cite:@[A-Za-z]+:\\([0-9]+\\]\\)" . ((lambda (tag)
                                                       (svg-tag-make tag
                                                                     :end -1
                                                                     :crop-left t))))


            ;; Active date (with or without day name, with or without time)
            (,(format "\\(<%s>\\)" date-re) .
             ((lambda (tag)
                (svg-tag-make tag :beg 1 :end -1 :margin 0))))
            (,(format "\\(<%s \\)%s>" date-re day-time-re) .
             ((lambda (tag)
                (svg-tag-make tag :beg 1 :inverse nil :crop-right t :margin 0))))
            (,(format "<%s \\(%s>\\)" date-re day-time-re) .
             ((lambda (tag)
                (svg-tag-make tag :end -1 :inverse t :crop-left t :margin 0))))

            ;; Inactive date  (with or without day name, with or without time)
            (,(format "\\(\\[%s\\]\\)" date-re) .
             ((lambda (tag)
                (svg-tag-make tag :beg 1 :end -1 :margin 0 :face 'org-date))))
            (,(format "\\(\\[%s \\)%s\\]" date-re day-time-re) .
             ((lambda (tag)
                (svg-tag-make tag :beg 1 :inverse nil :crop-right t :margin 0 :face 'org-date))))
            (,(format "\\[%s \\(%s\\]\\)" date-re day-time-re) .
             ((lambda (tag)
                (svg-tag-make tag :end -1 :inverse t :crop-left t :margin 0 :face 'org-date)))))))
#+end_src

** Super-agenda
#+begin_src elisp
  (use-package org-super-agenda
    :after org-agenda
    :config
    (org-super-agenda-mode t)
    (setq org-agenda-skip-scheduled-if-done t))

  (setq org-agenda-custom-commands
        '(("z" "Super view"
           ((tags "meta" ((org-agenda-overriding-header "Objetivos de 2023")))
            (agenda "" ((org-agenda-span 'week)
                        (org-agenda-overriding-header "")
                        ))
            (alltodo "" ((org-agenda-overriding-header "")
                         (org-agenda-remove-tags t)
                         (org-super-agenda-groups
                          '(
                            (:name "ðŸš¨ Atrasados"
                                   :deadline past
                                   :order 7)
                            (:name "PrÃ³ximos eventos"
                                   :discard (:tag ("finances"))
                                   :deadline future
                                   :order 8)
                            (:name "Sem data" :deadline nil :order 9)
                            (:discard (:tag ("Routine" "Daily" "meta" "finances")))))))
            ))))
#+end_src
** Functions
Check if a billing is paid based on the date
#+begin_src elisp
  (defun is-paid? (time)
    (if (eq (string-to-number (format-time-string "%m")) (nth 4 (org-parse-time-string time)))
        "-" "pago"))
#+end_src
Add ID to all headings [[https://stackoverflow.com/questions/13340616/assign-ids-to-every-entry-in-org-mode][source]]
#+begin_src elisp
  (defun add-id-to-tasks-in-file ()
    "Add ID properties to all tasks in the current file which
    do not already have one."
    (interactive)
    (org-ql-select (buffer-file-name)
      '(and
        (todo))
      :action #'org-id-get-create))
#+end_src
** Roam
#+begin_src elisp
  (use-package org-roam
    ;; :init
    ;; (setq org-roam-v2-ack t)
    :custom
    (org-roam-directory "~/Projects/org-files/roam")
    (setq org-roam-dailies-directory "daily/")
    (org-roam-completion-everywhere t)
    :bind (("C-c n l" . org-roam-buffer-toggle)
           ("<f4>" . org-roam-node-find)
           ("C-c n i" . org-roam-node-insert)
           ("<f12>" . org-roam-dailies-goto-today)
           ;; :map org-mode-map
           ;; ("C-M-i" . completion-at-point)
           :map org-roam-dailies-map
           ("Y" . org-roam-dailies-capture-yesterday)
           ("T" . org-roam-dailies-capture-tomorrow))
    :bind-keymap
    ("C-c n d" . org-roam-dailies-map)
    :config
    (require 'org-roam-dailies) ;; Ensure the keymap is available
    (org-roam-db-autosync-mode))
#+end_src
** Sync
#+begin_src elisp
  (defun org-agenda-export-to-ics ()
    (interactive)
    (org-icalendar-combine-agenda-files)
    (copy-file org-agenda-private-local-path org-agenda-private-remote-path t))

  (use-package midnight :straight (:type built-in)
    :config
    (midnight-delay-set 'midnight-delay 16200)
    (setq midnight-period 2400 ;; in seconds
          org-agenda-private-local-path "~/.org.ics"
          org-agenda-private-remote-path "~/Google Drive/My Drive/org.ics")
    :hook (midnight . org-agenda-export-to-ics)
    :bind ("C-c e i" . org-agenda-export-to-ics))

#+end_src
** Chef
#+begin_src elisp
  (use-package org-chef)
#+end_src

* Markdown
#+begin_src elisp
  (use-package markdown-mode)
#+end_src
* Web mode
#+begin_src elisp
  (use-package web-mode
    :mode (("\\.html?\\'" . web-mode))
    :config
    (setq web-mode-markup-indent-offset 2
          web-mode-enable-auto-indentation nil
          web-mode-css-indent-offset 2
          web-mode-code-indent-offset 2
          web-mode-block-padding 2
          web-mode-comment-style 2
          web-mode-enable-css-colorization t
          web-mode-enable-auto-pairing t
          web-mode-enable-comment-keywords t
          web-mode-enable-current-element-highlight t
          web-mode-enable-current-column-highlight t
          web-mode-content-types-alist  '(("django" . "\\.tpl\\'")))
    :hook (web-mode . auto-rename-tag-mode))
#+end_src
Auto rename tag
#+begin_src elisp
  (use-package auto-rename-tag
    :hook
      (tsx-ts-mode . auto-rename-tag-mode))
#+end_src

yasnippet
#+begin_src elisp
  (eval-after-load 'yasnippet
    '(let ((dir "~/.emacs.d/snippets/web-mode"))
        (add-to-list 'yas-snippet-dirs dir)
        (yas-load-directory dir)))
#+end_src
* Zencoding
#+begin_src elisp
  (use-package emmet-mode
    :hook ((web-mode tsx-ts-mode typescript-ts-mode) . emmet-mode)
    :config
    (setq emmet-indent-after-insert nil
          emmet-indentation 2
          emmet-expand-jsx-className? t
          emmet-move-cursor-between-quotes t
          emmet-self-closing-tag-style " /")
    (add-to-list 'emmet-jsx-major-modes 'tsx-ts-mode))

#+end_src
* Javascript
#+begin_src elisp
(setq js-indent-level 2)
#+end_src
** prettier
#+begin_src elisp
  (use-package prettier-js
    :ensure-system-package (prettier . "npm i -g prettier")
    :hook ((typescript-ts-mode . prettier-js-mode)
           (js-ts-mode . prettier-js-mode)
           (tsx-ts-mode . prettier-js-mode)))
#+end_src
** Jest mode
#+begin_src elisp
  (use-package jest-test-mode
    :ensure t
    :commands jest-test-mode
    :hook (typescript-mode js-mode typescript-tsx-mode))
#+end_src

* Typescript
#+begin_src elisp
  (use-package typescript-ts-mode
    :ensure-system-package (typescript-language-server . "npm i -g typescript-language-server"))

  (defun node-project-p ()
    "Predicate for determining if the open project is a Node one."
    (let ((p-root (cdr (project-current))))
      (file-exists-p (concat p-root "package.json"))))

  ;; source: https://github.com/emacs-typescript/typescript.el
  (require 'ansi-color)
  (defun colorize-compilation-buffer ()
    (ansi-color-apply-on-region compilation-filter-start (point-max)))
  (add-hook 'compilation-filter-hook 'colorize-compilation-buffer)
#+end_src
* Ruby
#+begin_src elisp
  (add-hook 'ruby-mode-hook 'flymake-ruby-load)
#+end_src
** Rubocop
#+begin_src elisp
  (use-package rubocop
    :config
    (setq rubocop-autocorrect-on-save t))
#+end_src
* Deno
#+begin_src elisp
  (defun deno-project-p ()
    "Predicate for determining if the open project is a Deno one."
    (let ((p-root (cdr (project-current))))
      (file-exists-p (concat p-root "deno.json"))))
#+end_src
* Elisp
** Unit Test
Buttercup
#+begin_src elisp
  (use-package buttercup)
#+end_src
* Lua :first-quarter-moon-with-face:
#+begin_src elisp
  (use-package lua-mode)
#+end_src
* Cooklang
#+begin_src elisp
  (straight-use-package
   '(el-patch :type git :host github :repo "cooklang/cook-mode"))
#+end_src
* JSON
#+begin_src elisp
  (use-package json-mode)
#+end_src
* Prisma
#+begin_src elisp
  (use-package prisma-mode
    :straight (prisma-mode :host github :repo "pimeys/emacs-prisma-mode")
    :ensure-system-package (prisma-language-server . "npm i -g @prisma/language-server"))
#+end_src
* YAML
#+begin_src elisp
  (use-package yaml-mode)
#+end_src
* Dart/Flutter
#+begin_src elisp
    (use-package dart-mode
      :hook (dart-mode . flutter-test-mode)
      (dart-mode . eglot-ensure))

    (use-package flutter
      :after (dart-mode)
      :bind (:map dart-mode-map
                  ("C-M-x" . #'flutter-run-or-hot-reload)))

    ;; (use-package lsp-dart
    ;;   :ensure t
    ;;   :hook (dart-mode . lsp)
    ;;   :custom
    ;;   (lsp-dart-flutter-sdk-dir "~/snap/flutter/common/flutter")
    ;;   :config
    ;;   (setq gc-cons-threshold (* 100 1024 1024)
    ;;         read-process-output-max (* 1024 1024)))
#+end_src
* Eglot
Original code from https://github.com/joaotavora/eglot/discussions/999
#+begin_src elisp
    (defun ecma-server-program (_)
      "Decide which server to use for ECMA Script based on project characteristics."
      (cond ((deno-project-p) '("deno" "lsp" :initializationOptions (:enable t :lint t)))
            ((node-project-p) '("typescript-language-server" "--stdio"))
            (t                nil)))

    ;; source: https://manueluberti.eu/2022/09/01/consult-xref.html
    (defun mu-project-find-regexp ()
      "Use `project-find-regexp' with completion."
      (interactive)
      (defvar xref-show-xrefs-function)
      (let ((xref-show-xrefs-function #'consult-xref))
        (if-let ((tap (thing-at-point 'symbol)))
            (project-find-regexp tap)
          (call-interactively #'project-find-regexp))))

    (defun eglot-shutdown-project ()
      "Kill the LSP server for the current project if it exists."
      (when-let ((server (eglot-current-server)))
        (ignore-errors (eglot-shutdown server))))

    (use-package eglot
      :straight t
      :init
      (put 'eglot-server-programs 'safe-local-variable 'listp)
      :hook
      (typescript-ts-mode . eglot-ensure)
      (js-mode . eglot-ensure)
      (js-ts-mode . eglot-ensure)
      (tsx-ts-mode . eglot-ensure)
      (web-mode . eglot-ensure)
      (prisma-mode . eglot-ensure)
      (eglot-managed-mode . flymake-eslint-enable-maybe)
      :bind (:map eglot-mode-map
                  ("C-c ." . eglot-code-actions)
                  ("C-c e r" . eglot-rename)
                  ("C-c e f" . eglot-format)
                  ("M-?" . xref-find-references)
                  ("M-." . xref-find-definitions)
                  ;;("C-c x a" . xref-find-apropos)
                  ("C-c f n" . flymake-goto-next-error)
                  ("C-c f p" . flymake-goto-prev-error)
                  ("C-c f d" . flymake-show-project-diagnostics))
      :custom
      (eglot-autoshutdown t)
      (eglot-menu-string "LSP")
      ;;(eglot-ignored-server-capabilities '(:documentHighlightProvider))
      (eglot-confirm-server-initiated-edits nil)
      :config
      (fset #'jsonrpc--log-event #'ignore)
      ;;(add-to-list 'eglot-stay-out-of 'eldoc-documentation-strategy)
      (put 'eglot-error 'flymake-overlay-control nil)
      (put 'eglot-note 'flymake-overlay-control nil)
      (put 'eglot-warning 'flymake-overlay-control nil)
      (advice-add 'eglot--apply-workspace-edit :after #'me/project-save)
      (advice-add 'project-kill-buffers :before #'me/eglot-shutdown-project)
      (add-to-list 'eglot-server-programs '((js-ts-mode tsx-ts-mode typescript-ts-mode) . ecma-server-program)))

#+end_src

* SQL
#+begin_src elisp
  (use-package sql-indent)
  (use-package sqlformat
    :config
    (setq sqlformat-command 'pgformatter
          sqlformat-args '("-s2" "-g"))
    :hook (sql-mode . sqlformat-on-save-mode)
    :bind (:map sql-mode-map ("C-c C-f" . sqlformat)))
#+end_src

* Vertigo
#+begin_src elisp
  (use-package vertico
    :init
    (vertico-mode))

  (use-package savehist
    :init
    (savehist-mode))

  (use-package orderless
    :custom
    (completion-styles '(orderless basic))
    (completion-category-overrides '((file (styles basic partial-completion)))))
#+end_src
* Consult
#+begin_src elisp
  (use-package consult
    :bind (("C-M-l" . consult-imenu)
           ("C-s" . consult-line)
           ("C-M-g" . consult-ripgrep)
           ("C-M-o" . consult-org-heading))
    :hook (completion-list-mode . consult-preview-at-point-mode)
    :init
    (autoload 'projectile-project-root "projectile")
    (setq register-preview-delay 0
          register-preview-function #'consult-register-format))
          ;;consult-project-function (lambda (_) (projectile-project-root))))

#+end_src
** Consult org
#+begin_src elisp
(use-package consult-org-roam
   :ensure t
   :after org-roam
   :init
   (require 'consult-org-roam)
   ;; Activate the minor mode
   (consult-org-roam-mode 1)
   :custom
   ;; Use `ripgrep' for searching with `consult-org-roam-search'
   (consult-org-roam-grep-func #'consult-ripgrep)
   ;; Configure a custom narrow key for `consult-buffer'
   (consult-org-roam-buffer-narrow-key ?r)
   ;; Display org-roam buffers right after non-org-roam buffers
   ;; in consult-buffer (and not down at the bottom)
   (consult-org-roam-buffer-after-buffers t)
   :config
   ;; Eventually suppress previewing for certain functions
   (consult-customize
    consult-org-roam-forward-links
    :preview-key (kbd "M-."))
   :bind
   ;; Define some convenient keybindings as an addition
   ("C-c n e" . consult-org-roam-file-find)
   ("C-c n b" . consult-org-roam-backlinks)
   ("C-c n l" . consult-org-roam-forward-links)
   ("C-c n r" . consult-org-roam-search))
#+end_src
* Embark
#+begin_src elisp :tangle no
  (use-package embark
    :ensure t

    :bind
    (("C-." . embark-act)         ;; pick some comfortable binding
     ("C-;" . embark-dwim)        ;; good alternative: M-.
     ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'

    :init
    ;; Optionally replace the key help with a completing-read interface
    (setq prefix-help-command #'embark-prefix-help-command)

    ;; Show the Embark target at point via Eldoc.  You may adjust the Eldoc
    ;; strategy, if you want to see the documentation from multiple providers.
    (add-hook 'eldoc-documentation-functions #'embark-eldoc-first-target)
    ;; (setq eldoc-documentation-strategy #'eldoc-documentation-compose-eagerly)

    :config
    ;; Hide the mode line of the Embark live/completions buffers
    (add-to-list 'display-buffer-alist
                 '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                   nil
                   (window-parameters (mode-line-format . none)))))

  ;; Consult users will also want the embark-consult package.
  (use-package embark-consult
    :ensure t ; only need to install it, embark loads it after consult if found
    :hook
    (embark-collect-mode . consult-preview-at-point-mode))
#+end_src
* which-key
#+begin_src elisp
  (use-package which-key
    :init
    (which-key-mode))
#+end_src
* Commit
Javascript
#+begin_src elisp
  (use-package js-comint)
#+end_src
* Ollama
#+begin_src elisp
  (use-package ellama
    :init
    (setopt ellama-language "English")
    ;;(setopt ellama-language "Portuguese")
    (require 'llm-ollama)
    (setopt ellama-provider
                    (make-llm-ollama
                     :chat-model "mistral" :embedding-model "mistral")))
#+end_src
* Read aloud
#+begin_src elisp
  (use-package read-aloud
    :config
    (setq read-aloud-engine "say"))
#+end_src
* CSV Mode
#+begin_src elisp
  (use-package csv-mode)
#+end_src
